<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>PV Web Socket</title>
</head>
<body>

<form>
  <input type="text" id="text">
  <input type="button" onclick="wsSendMessage();" value="Send">
  <input type="button" onclick="wsCloseConnection();" value="Disconnect">
</form>

<textarea id="response" rows="5" cols="30"></textarea>

<script type="text/javascript">
var text = document.getElementById("text");
text.value = "Type message...";
var response = document.getElementById("response");

var socket;

function openSocket()
{
	socket = new WebSocket("ws://localhost:8080/pvws/pv")
	socket.onopen = message => console.log("Connected");
	socket.onmessage = message => response.value += message.data;
	socket.onclose = message => handleClose();
	socket.onerror = message => console.log(message);
}

function wsSendMessage()
{
	socket.send(JSON.stringify({ name: text.value }));
}

function wsCloseConnection()
{
	socket.close();
}

function handleClose()
{
	console.log("Web socket was closed. Scheduling re-connect...");
	setTimeout(openSocket, 1000);
}

openSocket();

</script>

</body>
</html>