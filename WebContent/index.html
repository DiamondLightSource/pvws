<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>PV Web Socket</title>
<link rel="stylesheet" type="text/css" href="css/pvws.css">
<script type="text/javascript" src="js/jquery-3.3.1.js"></script>
<script type="text/javascript" src="js/pvws.js"></script>
</head>
<body>

<blockquote>
<h1>PV Web Socket</h1>

<form>
  <input type="text" id="text">
  <input type="button" onclick="wsSendMessage();" value="Send">
  <input type="button" value="Disconnect">
</form>

<textarea id="response" rows="5" cols="30"></textarea>



<h3>Ping</h3>

<p>
Sending a 'ping' message requests the server to 'ping' this client,
and a proper web client is supposed to automatically return a 'pong'
to the server.
(Internal test mechanism)
</p>
<pre>
{ "type": "ping" }
</pre>
<form>
  <input type="button" value="Ping">
</form>


<h3>Subscribe to PVs</h3>

<p>A 'subscribe' JSON message requests updates for one or more PVs.</p>
<pre>
{ "type": "subscribe", "pvs": [ "sim://sine", "loc://x(4)" ] }
</pre>

<p>A 'clear' JSON message cancels updates for one or more PVs.</p>
<pre>
{ "type": "clear", "pvs": [ "sim://sine", "loc://x(4)" ] }
</pre>
<form>
  <input type="text" id="pv_name" size="40" value="sim://sine">
  <br>
  <input type="button" value="Subscribe">
  <input type="button" value="Clear">
</form>


</blockquote>

<script type="text/javascript">
let text = document.getElementById("text");
text.value = "Type message...";
let response = document.getElementById("response");

let pvws = new PVWS("ws://localhost:8080/pvws/pv");

function wsSendMessage()
{
    pvws.socket.send(JSON.stringify({ type: 'echo', body: text.value }));
}

jQuery("input[value=Ping]").      click(() =>  pvws.ping() );
jQuery("input[value=Subscribe]"). click(() =>  pvws.subscribe(jQuery("#pv_name").val()) );
jQuery("input[value=Clear]")     .click(() =>  pvws.clear(jQuery("#pv_name").val()) );
jQuery("input[value=Disconnect]").click(() =>  pvws.close() );

jQuery(() =>
{
    console.log("LOADED");
    pvws.open();
});
</script>

</body>
</html>
